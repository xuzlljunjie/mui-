<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>设置密码</title>
	    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="icon" href="images/pand/pand.icon" type="image/x-icon" />
		<!--标准mui.css-->
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style>
			/* 登录 */
			#usertwoPassword{
				float: left;
				width: 100%;
			}
			.mui-input-group{
				text-align: center;
				padding: 15px;
				padding-top: 120px;	
			}
			.mui-content-padded button{
				width: 100%;
				height: 40px;
				color: #FFFFFF;
				font-weight: bold;
				border-radius: 21px;
				border: 0px;
				background: linear-gradient(to right,  #FF413A , #FF9849);
				margin-top: 37px;
			
			}
			 .mui-input-row input{
				border: 0px;
				width: 100%;
				padding: 0;
				font-size: 16px;
				color: #333333;
				margin-top: 15px;
			   
				}
			.mui-input-row{
				border-bottom: 1px solid #FF413A;
				float: left;
				width: 100%;
				height: 5px;
				padding-bottom:12px;
				
			}
			.mui-verify{
				height: 30px;
				width: 30%;
				float: right;
			    margin-top: 17px;
				border-radius: 15px;
				border: 0px;
				font-size: 14px;
				color: #FF413A;
				background-color: #F4F4F4;
			}
			.mui-content-padded{margin-top: 100px;}
			.mui-content{background: #fff;;}
			
			.mui-btn-primary:enabled:active{
				color: #fff;
                border: 1px solid #FF413A; 
                background-color: #FF413A; 
			}
			#testLogin{text-align: center;margin-top: 50px;}
			#testLogin img{width:53px;height:53px;}
			.wechat{font-size: 12px; color: #999999;}
			.loginopcity{opacity: 0.5;}
			.mui-checkbox input[type=checkbox]{
	         	position: absolute;
			    top: 0px;
			    left: 10px;
			    display: inline-block;
			    width: 15px;
			    height: 15px;
			    border: 0;
			    outline: 0!important;
			    background-color: transparent;
			    -webkit-appearance: none;
	         }
	        .mui-checkbox input[type=checkbox]:before{
	        	font-size: 17px;
	        }
	        .mui-checkbox input[type=checkbox]:checked:before{
	        	color: #FF413A;
	        }
	        .agreexieyi{color: #333333;font-size: 12px;padding-left: 30px;}
	        .mui-input-group .mui-input-row:after{height:0px;}
	        .mui-input-group:after{height:0px;}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-icon mui-icon-left-nav mui-pull-left mui-action-back"></a>
			<h1 class="mui-title">设置密码</h1>
		</header>
		<div class="mui-content" id="registerhtml">
		 <div class="mui-input-group">
		    <div class="mui-input-row">
		    <input type="password" id="userPassword" @blur="animateWidth('userPassword','blur')" @focus="animateWidth('userPassword','focus')"  class="mui-input-clear" placeholder="请输入密码">
		    </div>
		    <div class="mui-input-row">
		        <input id="usertwoPassword"  @blur="animateWidth('usertwoPassword','blur')" @focus="animateWidth('usertwoPassword','focus')" type="password"  class="mui-input-password" placeholder="再次输入密码">
		    </div>
		 </div>
		 <div class="mui-content-padded">
		     <button  id='login' @click="login()" class="mui-btn  mui-btn-primary">确认</button>
		</div>
	</div>
	</body>
	<script src="../../js/vue.min.js"></script>
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/jquery.min.js"></script>
	<script src="../../js/tool.js"></script>
	<script type="text/javascript" src="../../js/config.js" ></script>
	<script type="text/javascript" src="../../js/app.js" ></script>
	<script type="text/javascript">
	   mui.init({
			swipeBack:true //启用右滑关闭功能
		});
		var vm = new Vue({
	        el: '#registerhtml',
	        data: {
//	          authCodetype:1,  //判断输入方式
	          regType:3,       //注册类型
	          userPhone:"",  //用户手机号
	          authCode:"",   //手机验证码
	          userId:"",
	        },
			mounted: function () {
			    var _this = this;
			    this.$nextTick(function() {
			       mui.plusReady(function(){
			            _this.InitMain();
			        })
			    }) 
		    },
	        methods: {
		        //去注册
		        login:function(){
		        	var _this = this;
		        	if(!document.getElementById('userPassword').value){
		        		mui.toast('请输入用户密码');
		        		return false;
		        	}
		        	var params = {
		        		userId:_this.userId,
		        		userPassword:document.getElementById('userPassword').value,	
		             
					};
					mui.ajax({
						url: CONFIG.basePath+ '/api/panduser/panduser_setpasswd',
						async: false,
						data: params,
						dataType: "json",
						type: 'post',
						success: function(res){
							console.log('设置状态'+res.message);
							console.log('设置状态'+res.result);
							if(res.result==1){
								mui.openWindow({
										url: "/model/login/login.html",
						                 id: "login.html"
										
									})
								
								
							}else{
								mui.toast(res.message);
							}
						},
						error: function(xhr, type, errorThrown){
							mui.toast('服务器响应失败');
						}
					});
		        },
		        animateWidth:function(name,type){
		        	var _this = this;
		        	if (name == "usertwoPassword") {
				        if (type == "blur"&&$("#usertwoPassword").val()!="") {
				        	if($("#usertwoPassword").val()!=$("#userPassword").val()){
				        		mui.toast("两次输入的密码不一致");
				        		$("#usertwoPassword").val('');
				        	}else{
//				        	  _this.authCodetype = 2;
				        	}
				        } else {
//				          _this.authCodetype = 1;
				          return;
				        }
				    }else if(name == "userPassword"){
				    	if (type == "blur") {
				    		var regex = new RegExp('^(?![a-zA-Z]+$)(?![A-Z0-9]+$)(?![A-Z\W_!@#$%^&*`~()-+=]+$)(?![a-z0-9]+$)(?![a-z\W_!@#$%^&*`~()-+=]+$)(?![0-9\W_!@#$%^&*`~()-+=]+$)[a-zA-Z0-9\W_!@#$%^&*`~()-+=]{8,30}$');
				    		if(!regex.test($("#userPassword").val())){
							    mui.toast("输入错误：密码不符合规则，请重新输入。");
							    $("#userPassword").val('')
							    return;
							}
				        }
				    }
		        },
		        //初始化
                InitMain: function() {
                	var _this = this;
                	var sData = plus.webview.currentWebview();
                	_this.userId=sData.userId;
                },
		    }
	    });
	</script>
</html>